var app=angular.module("app",["ionic","ngCordova","app.controllers","app.routes","app.services","app.directives"],function(t){t.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8";var e=function(t){var n,r,o,a,i,l,s,c="";for(n in t)if(r=t[n],r instanceof Array)for(s=0;s<r.length;++s)i=r[s],o=n+"["+s+"]",l={},l[o]=i,c+=e(l)+"&";else if(r instanceof Object)for(a in r)i=r[a],o=n+"["+a+"]",l={},l[o]=i,c+=e(l)+"&";else void 0!==r&&null!==r&&(c+=encodeURIComponent(n)+"="+encodeURIComponent(r)+"&");return c.length?c.substr(0,c.length-1):c};t.defaults.transformRequest=[function(t){return angular.isObject(t)&&"[object File]"!==String(t)?e(t):t}]}).run(function(t,e,n,r,o,a,i,l){t.ready(function(){window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar&&StatusBar.styleDefault(),t.registerBackButtonAction(function(t){return"/tab/news"==r.path()?e.backButtonPressedOnceToExit?ionic.Platform.exitApp():(e.backButtonPressedOnceToExit=!0,i.showShortTop("再按一次退出系统"),setTimeout(function(){e.backButtonPressedOnceToExit=!1},2e3)):a.backView()?a.goBack():(e.backButtonPressedOnceToExit=!0,i.showShortTop("再按一次退出系统"),setTimeout(function(){e.backButtonPressedOnceToExit=!1},2e3)),t.preventDefault(),!1},101)});var s=["tabs.medicalrecored","tabs.my"];e.$on("$stateChangeStart",function(t,e,r,o){if("login"!=e.name)for(var a in s){var i=s[a];i==e.name&&(l.isLogin()||(t.preventDefault(),n.go("login",{from:o.name,w:"notLogin"})));break}})});app.config(function(t){t.tabs.position("bottom")}),app.constant("APPCONFIG",{SERVER_URL_PRE:"http://localhost:8100/api"}),angular.module("app.controllers",[]).controller("mainIndexCtrl",function(t,e){t.toSearch=function(){e.go("searchHosAndDoc")}}).controller("mainMedicalrecordCtrl",function(t,e,n,r){t.patientId=e.patientId,t.patient=null,t.doRefresh=function(){t.patient?t.loadMedicalRecored():t.patientId?r.getPatientById(patientId).then(function(e){t.patient=e,t.loadMedicalRecored()}):r.getCurrentPatient().then(function(e){t.patient=e,t.loadMedicalRecored()})},t.loadMedicalRecored=function(){t.patient&&n.getOutpatientRecords(t.patient.idNo).then(function(e){t.records=e,t.$broadcast("scroll.refreshComplete")})},t.doRefresh()}).controller("mainNewsCtrl",function(){}).controller("mainMyCtrl",function(){}).controller("loginCtrl",function(t,e){t.loginParams={username:null,password:null},t.login=function(){e.login(t.loginParams)}}).controller("searchHosAndDocCtrl",function(t,e,n,r){t.search=function(){n.getHospitals({keyWord:t.searchStr}).then(function(e){t.hospitals=e.hospitalSimples}),r.getDoctors({keyWord:t.searchStr}).then(function(e){t.doctors=e.doctors})}}).controller("messagesCtrl",function(t,e){e.getUnreadMessages().then(function(e){t.messages=e.data.message})}).controller("hosDetailCtrl",function(t,e){t.hos=e}).controller("signupCtrl",function(){}),angular.module("app.directives",[]).directive("blankDirective",[function(){}]),angular.module("app.routes",[]).config(function(t,e){t.state("tabs",{url:"/tab",templateUrl:"templates/tabsController.html","abstract":!0}).state("tabs.index",{url:"/index",views:{tabIndex:{templateUrl:"templates/main_index.html",controller:"mainIndexCtrl"}}}).state("tabs.hospital",{url:"/hospital",views:{tabHospital:{resolve:{hos:function(t){return t.getDefaultHospital()}},templateUrl:"templates/hospital/detail.html",controller:"hosDetailCtrl"}}}).state("tabs.hospitalDetail",{url:"/hospital/:id",views:{tabHospital:{resolve:{hos:function(t,e){return t.getHospitalById(e.id)}},templateUrl:"templates/hospital/detail.html",controller:"hosDetailCtrl"}}}).state("tabs.medicalrecored",{url:"/medicalrecored",cache:!1,views:{tabMedicalrecored:{templateUrl:"templates/main_medicalrecored.html",controller:"mainMedicalrecordCtrl"}}}).state("tabs.news",{url:"/news",views:{tabNews:{templateUrl:"templates/main_news.html",controller:"mainNewsCtrl"}}}).state("news.detail",{url:"/news/:newsId",views:{tabNews:{templateUrl:"templates/news/news_detail.html",controller:"newsDetailCtrl"}}}).state("tabs.my",{url:"/my",views:{tabMy:{templateUrl:"templates/main_my.html",controller:"mainMyCtrl"}}}).state("login",{url:"/login",templateUrl:"templates/login.html",controller:"loginCtrl"}).state("signup",{url:"/signup",templateUrl:"templates/signup.html",controller:"signupCtrl"}).state("messages",{url:"/messages",templateUrl:"templates/message/messages.html",controller:"messagesCtrl"}).state("searchHosAndDoc",{url:"/searchHosAndDoc",templateUrl:"templates/search/search_hosanddoc.html",controller:"searchHosAndDocCtrl"}),e.otherwise("/tab/index")}),angular.module("app.services",[]).factory("BlankFactory",function(){}).factory("UTIL_DIALOG",function(t){return{show:function(e,n){t.alert({title:n||"提示信息",buttons:[{text:"确认",type:"button-balanced"}],template:e})}}}).factory("UTIL_LOADING",function(t){return{show:function(){t.show({template:"加载中..."})},close:function(){t.hide()}}}).factory("UTIL_HTTP",function(t,e,n,r,o,a,i){function l(l){if(l){var s=a.getToken();s&&(l.data?l.data.token=s:l.data={token:s});var c=null;if(l.isShowLoading!==!1){var u=1e3;c=setTimeout(function(){r.show()},u)}var d=e.defer(),p=d.promise,f={url:i.SERVER_URL_PRE+l.url,dataType:"json"};return l.type=l.type||"GET",f.method=l.type,"GET"==l.type?f.params=l.data:f.data=l.data,t(f).success(function(t){c&&(clearTimeout(c),c=null),r.close(),t&&("1"===t.success?d.resolve(t.data):"0"===t.success?(o.show(t.msg||"加载失败"),d.reject("加载失败")):"403"===t.success&&n.go("login"))}).error(function(t){c&&(clearTimeout(c),c=null),r.close(),o.show("加载失败"),d.reject(t)}),p}}return{get:function(t){var e=t;return e?e.type="GET":e={type:"GET"},l(e)},post:function(t){var e=t;return e?e.type="POST":e={type:"POST"},l(e)}}}).factory("UTIL_USER",function(){var t={ISLOGIN:!1,USER_ID:null,TOKEN:null,INFO:null};return{isLogin:function(){return t.ISLOGIN},getUserId:function(){return t.USER_ID},getUser:function(){return t.INFO},getToken:function(){return t.TOKEN},IS_Expire:function(){if(!t.INFO)return!0;var e=t.INFO.expire;return e?e.getTime()<=(new Date).getTime()?!0:!1:!0},setLoginState:function(e){t.ISLOGIN=e},setUserInfo:function(e){t.INFO=e},setUserId:function(e){t.USER_ID=e},setToken:function(e){t.TOKEN=e},logout:function(){t={ISLOGIN:!1,USER_ID:null,TOKEN:null,INFO:null}}}}).service("NewsService",function(t){return{getNews:function(){return t.get({url:"/arrayJob/default"})}}}).service("HospitalService",function(t){return{getHospitals:function(e){return t.get({url:"/hospital",data:e})},getHospitalById:function(e){return t.get({url:"/hospital/"+e})},getDefaultHospital:function(){return t.get({url:"/hospital/default"})}}}).service("DoctorService",function(t){return{getDoctors:function(e){return t.get({url:"/doctor",data:e})},getDoctorById:function(e){return t.get({url:"/doctor/"+e})}}}).service("MedicalRecordService",function(t){return{getOutpatientRecords:function(e){return t.get({url:"/medicalRecords/patient-"+e})},getOutpatientRecordsPrescribe:function(e){return t.get({url:"/medicalRecords-prescribe/patient-"+e})},getOutpatientRecordsFee:function(e){return t.get({url:"/medicalRecords-fee/patient-"+e})},getOutpatientRecordsCheckReport:function(e){return t.get({url:"/medicalRecords-checkreport/patient-"+e})},getOutpatientRecordsTestReport:function(e){return t.get({url:"/medicalRecords-testreport/patient-"+e})},getOutpatientDetail:function(e){return t.get({url:"/medicalRecordsDetail/patient-"+e})}}}).service("MessageService",function(t){return{getUnreadMessages:function(){return t.get({url:"/usermessage/unread"})}}}).service("PatientService",function(t){return{getCurrentPatient:function(){return t.get({url:"/patient/current"})},getMyPatients:function(e){return t.get({url:"/patients",data:e})},getPatientById:function(e){return t.get({url:"/patient/"+e})},addPatient:function(e){return t.get({url:"/patient/add",data:e})},editPatient:function(e){return t.get({url:"/patient/edit",data:e})}}}).service("UserService",function(t,e,n,r){return{login:function(o){t.post({url:"/login",data:o}).then(function(t){if(t){var o=t.expire,a=new Date;a.setSeconds(a.getSeconds()+o),e.setToken(t.token),e.setUserId(t.userId),e.setUserInfo({id:t.userId,token:t.token,expire:a}),e.setLoginState(!0);var i=r.from;n.go(i&&"login"!=i?i:"tabs.index")}})},logout:function(){t.post({url:"/logout"}).then(function(){e.logout(),n.go("login")})}}});